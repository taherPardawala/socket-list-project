<html ng-app="list">
<head>
    <title>Chat app using express and socket</title>
    <style>
        #chatbox{
            height : 500px;
            overflow: scroll;
        }
        
        #chatbox ul{
            list-style: none;
            margin: 0;
            padding-left: 0px;
        }
        
        .redborder{
            border: 1px red solid;
            padding: 5px;
        }
        
        .deleteMe{
            float: right;
            background: yellow;
        }
        
        #chatWrap{
            float:left;
            border: 1px solid;
        }
    </style>
    
</head>
<body>
    
    <div id="userWrap" ng-controller="userController" ng-show="userVis">
        <p>Enter a username</p>
        <p id="userError" ng-model="errormsg">{{errormsg}}</p>
        <form id="setUsername">
            <input size="35" id="namebox" ng-model = "username"/>
            <input type="submit" ng-click="setName($event)"/>
        </form>
    </div>
    
    <div id="chatContainer" ng-controller="chatController" ng-show="chatVis">
        <div id="chatWrap">
            <div id = "chatbox">
                <ul></ul>
            </div>
            <form id = "sent-message">
                <input size = "35" id = "message" />
                <input type = "submit" />
            </form>
        </div>
        <div id="users"></div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src = "/socket.io/socket.io.js"></script>
    
    <script>
        var socket = io.connect();
        var app = angular.module('list',[]);
        
        var userController = function($scope){
            
            $scope.$emit('chatbox vis' , false);
            $scope.userVis = true;
            
            $scope.setName = (e)=>{
                e.preventDefault();
                socket.emit('new user', $scope.username ,function(data){
                                console.log("in callback of newuser");
                                console.log(data);
                                console.log(typeof data);
                                if(true){
                                    console.log('omkar')
                                    $scope.userVis = false;
                                    $scope.$emit('chatbox vis' , true);
                                }
                                else {
                                    $scope.errormsg = "Username is already taken";
                                }
                            });
                    $scope.username = "";
            }
        };
        
        var chatController = function($scope){
            $scope.$on('chatbox vis',function(data){
                $scope.chatVis = data;
                console.log("chat box: "+data)
            });
        };
        
        
        app.controller("userController" , userController);
        app.controller("chatController" , chatController);
        
    </script>
</body>
</html>